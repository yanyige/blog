---
layout: default
title: jQuery源码分析 (第二部分)
---
# 第一章 构造jQuery对象
jQuery对象是一个类数组对象，含有连续的整型属性、length属性和大量的jQuery方法。jQuery对象由构造函数jQuery()创建，$()则是jQuery()的缩写。
## 2.1 构造函数jQuery()
如果调用构造函数jQuery时传入的参数不同，创建jQuery对象的逻辑也会不同，构造函数jQuery有7种方法。如下：
- jQuery( selector [, context])接受一个css表达式和一个可选的选择器上下文，返回了一个包含匹配DOM元素的jQuery对象。
- jQuery (html [,ownerDocument])、jQuery(html, props) 创建一个DOM元素
- jQuery( element)、jQuery( elementArray ) 如果传入一个DOM元素或者DOM数组，则会把DOM元素封装到jQuery对象中并且返回
- jQuery( callback )
- jQuery( jQuery object )
- jQUery( )

### 2.1.1 jQuery( selector [, context])
如果传入一个字符串参数，jQuery会检查这个字符串是选择器还是html代码，如果是选择器表达式，则遍历文档，查找与之匹配的DOM元素，并创建一个包含了这些DOM元素引用的jQuery对象；如果没有匹配的对象，则会创建一个空jQuery对象。下一节介绍参数是HTML代码的情况。  
默认情况下，对匹配元素的查找将会从document对象开始，即查找整个文档树，不过也可以传入第二个参数context来限定查找范围。例如，可以这样限制查找范围。
```
$('div.foo').click(function() {
    $('span', this).addClass('bar');
});
```
方法find是调用CSS选择器引擎Sizzle实现，会在第三章进行介绍和分析。
### 2.1.2 jQuery ( html [,ownerDocument] )、jQuery( html, props )
如果传入的参数是一段html代码，jQuery则会尝试用这段HTML代码创建新的DOM元素，并且创建一个包含了这些DOM元素引入的jQuery对象。  
第二个参数ownerDocument用于指定创建的新的DOM元素的文档对象，如果不传入，则默认为当前文档对象。  
第二个参数还可以是props。属性可以是任意的时间类型（如"click"）还可以有下面的特殊属性:val, css, html, text, data, width, height, offset, 对应的jQuery方法: .val(), .css(), .html(), .text(), data(), width(), height(), offset()将会执行。举个梨子：
```
$('<div>', {
    "class": "test",
    text: "click me",
    click: function() {
        $(this).toggleClass("test");
    }
}).appendTo("body")
```
### 2.1.3 jQuery( element)、jQuery( elementArray )
如果传入一个DOM元素或者DOM数组，则会把DOM元素封装到jQuery对象中并且返回。

### 2.1.4 jQuery( object )
如果传入一个普通的jQuery对象，则会把这个对象封装jQuery对象中并且返回。
举个梨子:
```
var foo = {foo: 'bar', hello: 'world'};

var $foo = $(foo);

$foo.on('custom', function(){
    console.log('custom event is called');
});

$foo.triggle('custom');
```

### 2.1.5 jQuery( callback )
如果传入一个函数，则在document上绑定一个ready事件监听函数，当DOM结构加载完成时执行。ready事件触发要早于load事件。ready事件并不是浏览器的原生事件，而是DOMContentLoaded事件、onreadystatechange事件和函数doScrollCheck()的统称。将在后面的学习中介绍。

### 2.1.6 jQuery( jQuery object )
如果传入一个jQuery对象，则创建这个jQuery对象的一个副本并且返回，副本与传入的jQuery对象引入的同一个元素。